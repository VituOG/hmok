<!DOCTYPE html>
<html lang="pt-BR" data-theme="light">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>Teste de Performance - PulseX</title>
	<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
	<link rel="stylesheet" href="/src/styles/optimized.css" />
	
	<style>
		.test-section {
			margin: 2rem 0;
			padding: 2rem;
			border: 1px solid #ddd;
			border-radius: 12px;
			background: #f9f9f9;
		}
		
		.test-result {
			padding: 1rem;
			margin: 1rem 0;
			border-radius: 8px;
			font-family: monospace;
		}
		
		.test-result.success {
			background: #d4edda;
			color: #155724;
			border: 1px solid #c3e6cb;
		}
		
		.test-result.error {
			background: #f8d7da;
			color: #721c24;
			border: 1px solid #f5c6cb;
		}
		
		.test-result.info {
			background: #d1ecf1;
			color: #0c5460;
			border: 1px solid #bee5eb;
		}
		
		.performance-metrics {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
			gap: 1rem;
			margin: 1rem 0;
		}
		
		.metric-card {
			background: white;
			padding: 1rem;
			border-radius: 8px;
			box-shadow: 0 2px 4px rgba(0,0,0,0.1);
			text-align: center;
		}
		
		.metric-value {
			font-size: 2rem;
			font-weight: bold;
			color: var(--primary);
		}
		
		.metric-label {
			font-size: 0.9rem;
			color: var(--muted);
			margin-top: 0.5rem;
		}
	</style>
</head>
<body>
	<header class="site-header">
		<nav class="container nav">
			<a href="/" class="brand">PulseX</a>
			<ul class="nav-links">
				<li><a href="/">Home</a></li>
				<li><a href="/features.html">Recursos</a></li>
				<li><a href="/download.html">Download</a></li>
			</ul>
		</nav>
	</header>

	<main class="section">
		<div class="container">
			<h1 class="section-title">🧪 Teste de Performance - PulseX</h1>
			<p>Esta página testa todas as funcionalidades e otimizações do PulseX.</p>

			<!-- Teste de Identidade -->
			<div class="test-section">
				<h2>✅ Teste de Identidade</h2>
				<div id="identity-test" class="test-result info">
					Verificando identidade do projeto...
				</div>
			</div>

			<!-- Teste de Performance -->
			<div class="test-section">
				<h2>⚡ Teste de Performance</h2>
				<div class="performance-metrics" id="performance-metrics">
					<div class="metric-card">
						<div class="metric-value" id="load-time">-</div>
						<div class="metric-label">Tempo de Carregamento</div>
					</div>
					<div class="metric-card">
						<div class="metric-value" id="memory-usage">-</div>
						<div class="metric-label">Uso de Memória</div>
					</div>
					<div class="metric-card">
						<div class="metric-value" id="fps">-</div>
						<div class="metric-label">FPS</div>
					</div>
					<div class="metric-card">
						<div class="metric-value" id="score">-</div>
						<div class="metric-label">Score Geral</div>
					</div>
				</div>
			</div>

			<!-- Teste de Funcionalidades -->
			<div class="test-section">
				<h2>🔧 Teste de Funcionalidades</h2>
				<div id="features-test" class="test-result info">
					Testando funcionalidades...
				</div>
			</div>

			<!-- Teste de Responsividade -->
			<div class="test-section">
				<h2>📱 Teste de Responsividade</h2>
				<div id="responsive-test" class="test-result info">
					Testando responsividade...
				</div>
			</div>

			<!-- Teste de Acessibilidade -->
			<div class="test-section">
				<h2>♿ Teste de Acessibilidade</h2>
				<div id="accessibility-test" class="test-result info">
					Testando acessibilidade...
				</div>
			</div>

			<!-- Teste de PWA -->
			<div class="test-section">
				<h2>📱 Teste de PWA</h2>
				<div id="pwa-test" class="test-result info">
					Testando funcionalidades PWA...
				</div>
			</div>

			<!-- Botões de Teste -->
			<div class="test-section">
				<h2>🎮 Testes Interativos</h2>
				<div style="display: flex; gap: 1rem; flex-wrap: wrap;">
					<button class="btn-primary" onclick="testToast()">Testar Toast</button>
					<button class="btn-secondary" onclick="testTheme()">Alternar Tema</button>
					<button class="btn-primary" onclick="testDownload()">Testar Download</button>
					<button class="btn-secondary" onclick="testAnimations()">Testar Animações</button>
					<button class="btn-primary" onclick="runAllTests()">Executar Todos os Testes</button>
				</div>
			</div>
		</div>
	</main>

	<!-- Toast Container -->
	<div id="toast-container" class="toast-container"></div>

	<script>
		// Teste de Performance
		class PerformanceTester {
			constructor() {
				this.startTime = performance.now()
				this.metrics = {}
			}

			measureLoadTime() {
				const loadTime = performance.now() - this.startTime
				this.metrics.loadTime = loadTime
				document.getElementById('load-time').textContent = `${loadTime.toFixed(0)}ms`
				return loadTime
			}

			measureMemory() {
				if ('memory' in performance) {
					const memory = performance.memory
					const usedMB = (memory.usedJSHeapSize / 1024 / 1024).toFixed(1)
					this.metrics.memory = usedMB
					document.getElementById('memory-usage').textContent = `${usedMB}MB`
					return usedMB
				} else {
					document.getElementById('memory-usage').textContent = 'N/A'
					return 'N/A'
				}
			}

			measureFPS() {
				let frameCount = 0
				let lastTime = performance.now()
				
				const measureFrame = () => {
					frameCount++
					const currentTime = performance.now()
					
					if (currentTime - lastTime >= 1000) {
						const fps = Math.round((frameCount * 1000) / (currentTime - lastTime))
						this.metrics.fps = fps
						document.getElementById('fps').textContent = `${fps} FPS`
						frameCount = 0
						lastTime = currentTime
					}
					
					requestAnimationFrame(measureFrame)
				}
				
				requestAnimationFrame(measureFrame)
			}

			calculateScore() {
				const loadTime = this.metrics.loadTime || 0
				const memory = this.metrics.memory || 0
				const fps = this.metrics.fps || 60
				
				let score = 100
				
				// Penalizar tempo de carregamento lento
				if (loadTime > 2000) score -= 20
				else if (loadTime > 1000) score -= 10
				
				// Penalizar uso de memória alto
				if (memory !== 'N/A' && memory > 50) score -= 15
				else if (memory !== 'N/A' && memory > 30) score -= 5
				
				// Penalizar FPS baixo
				if (fps < 30) score -= 25
				else if (fps < 50) score -= 10
				
				this.metrics.score = Math.max(0, score)
				document.getElementById('score').textContent = `${score}/100`
				return score
			}
		}

		// Teste de Identidade
		function testIdentity() {
			const testResult = document.getElementById('identity-test')
			const tests = [
				{ name: 'Título da página', test: () => document.title.includes('PulseX') },
				{ name: 'Brand no header', test: () => document.querySelector('.brand').textContent === 'PulseX' },
				{ name: 'LocalStorage keys', test: () => !localStorage.getItem('hone_user') && !localStorage.getItem('hone_show_boot') },
				{ name: 'Service Worker', test: () => 'serviceWorker' in navigator }
			]
			
			let passed = 0
			let total = tests.length
			
			tests.forEach(({ name, test }) => {
				if (test()) {
					passed++
				}
			})
			
			if (passed === total) {
				testResult.className = 'test-result success'
				testResult.innerHTML = `✅ Todos os ${total} testes de identidade passaram!`
			} else {
				testResult.className = 'test-result error'
				testResult.innerHTML = `❌ ${passed}/${total} testes de identidade passaram.`
			}
		}

		// Teste de Funcionalidades
		function testFeatures() {
			const testResult = document.getElementById('features-test')
			const tests = [
				{ name: 'Toast system', test: () => typeof showToast === 'function' },
				{ name: 'Theme toggle', test: () => document.documentElement.hasAttribute('data-theme') },
				{ name: 'Responsive design', test: () => window.innerWidth > 0 },
				{ name: 'CSS variables', test: () => getComputedStyle(document.documentElement).getPropertyValue('--primary') }
			]
			
			let passed = 0
			let total = tests.length
			
			tests.forEach(({ name, test }) => {
				if (test()) {
					passed++
				}
			})
			
			if (passed === total) {
				testResult.className = 'test-result success'
				testResult.innerHTML = `✅ Todos os ${total} testes de funcionalidades passaram!`
			} else {
				testResult.className = 'test-result error'
				testResult.innerHTML = `❌ ${passed}/${total} testes de funcionalidades passaram.`
			}
		}

		// Teste de Responsividade
		function testResponsiveness() {
			const testResult = document.getElementById('responsive-test')
			const tests = [
				{ name: 'Mobile menu', test: () => document.querySelector('.mobile-menu') !== null },
				{ name: 'CSS Grid support', test: () => CSS.supports('display', 'grid') },
				{ name: 'Flexbox support', test: () => CSS.supports('display', 'flex') },
				{ name: 'Viewport meta', test: () => document.querySelector('meta[name="viewport"]') !== null }
			]
			
			let passed = 0
			let total = tests.length
			
			tests.forEach(({ name, test }) => {
				if (test()) {
					passed++
				}
			})
			
			if (passed === total) {
				testResult.className = 'test-result success'
				testResult.innerHTML = `✅ Todos os ${total} testes de responsividade passaram!`
			} else {
				testResult.className = 'test-result error'
				testResult.innerHTML = `❌ ${passed}/${total} testes de responsividade passaram.`
			}
		}

		// Teste de Acessibilidade
		function testAccessibility() {
			const testResult = document.getElementById('accessibility-test')
			const tests = [
				{ name: 'Skip links', test: () => document.querySelector('.skip-link') !== null },
				{ name: 'Alt text', test: () => document.querySelectorAll('img[alt]').length > 0 },
				{ name: 'ARIA labels', test: () => document.querySelectorAll('[aria-label]').length > 0 },
				{ name: 'Semantic HTML', test: () => document.querySelectorAll('main, header, nav, section').length > 0 }
			]
			
			let passed = 0
			let total = tests.length
			
			tests.forEach(({ name, test }) => {
				if (test()) {
					passed++
				}
			})
			
			if (passed === total) {
				testResult.className = 'test-result success'
				testResult.innerHTML = `✅ Todos os ${total} testes de acessibilidade passaram!`
			} else {
				testResult.className = 'test-result error'
				testResult.innerHTML = `❌ ${passed}/${total} testes de acessibilidade passaram.`
			}
		}

		// Teste de PWA
		function testPWA() {
			const testResult = document.getElementById('pwa-test')
			const tests = [
				{ name: 'Service Worker', test: () => 'serviceWorker' in navigator },
				{ name: 'Manifest', test: () => document.querySelector('link[rel="manifest"]') !== null },
				{ name: 'HTTPS', test: () => location.protocol === 'https:' || location.hostname === 'localhost' },
				{ name: 'App icons', test: () => document.querySelector('link[rel="icon"]') !== null }
			]
			
			let passed = 0
			let total = tests.length
			
			tests.forEach(({ name, test }) => {
				if (test()) {
					passed++
				}
			})
			
			if (passed === total) {
				testResult.className = 'test-result success'
				testResult.innerHTML = `✅ Todos os ${total} testes de PWA passaram!`
			} else {
				testResult.className = 'test-result error'
				testResult.innerHTML = `❌ ${passed}/${total} testes de PWA passaram.`
			}
		}

		// Funções de teste interativo
		function showToast(message, type = 'info') {
			const container = document.getElementById('toast-container')
			const toast = document.createElement('div')
			toast.className = `toast ${type}`
			toast.innerHTML = `
				<div class="toast-icon">${type === 'success' ? '✅' : type === 'error' ? '❌' : 'ℹ️'}</div>
				<div class="toast-message">${message}</div>
				<button class="toast-close" onclick="this.parentElement.remove()">×</button>
			`
			container.appendChild(toast)
			
			setTimeout(() => {
				if (toast.parentElement) {
					toast.remove()
				}
			}, 5000)
		}

		function testToast() {
			showToast('Teste de toast funcionando!', 'success')
		}

		function testTheme() {
			const currentTheme = document.documentElement.getAttribute('data-theme')
			const newTheme = currentTheme === 'dark' ? 'light' : 'dark'
			document.documentElement.setAttribute('data-theme', newTheme)
			showToast(`Tema alterado para ${newTheme}`, 'info')
		}

		function testDownload() {
			showToast('Simulando download...', 'info')
			setTimeout(() => {
				showToast('Download concluído!', 'success')
			}, 2000)
		}

		function testAnimations() {
			const elements = document.querySelectorAll('.test-section')
			elements.forEach((el, index) => {
				setTimeout(() => {
					el.style.animation = 'slide-up 0.5s ease'
					setTimeout(() => {
						el.style.animation = ''
					}, 500)
				}, index * 100)
			})
			showToast('Animações testadas!', 'info')
		}

		function runAllTests() {
			testIdentity()
			testFeatures()
			testResponsiveness()
			testAccessibility()
			testPWA()
			showToast('Todos os testes executados!', 'success')
		}

		// Inicialização
		document.addEventListener('DOMContentLoaded', () => {
			const tester = new PerformanceTester()
			
			// Medir métricas de performance
			tester.measureLoadTime()
			tester.measureMemory()
			tester.measureFPS()
			
			// Calcular score após um delay
			setTimeout(() => {
				tester.calculateScore()
			}, 1000)
			
			// Executar testes
			testIdentity()
			testFeatures()
			testResponsiveness()
			testAccessibility()
			testPWA()
			
			console.log('🧪 Teste de Performance do PulseX inicializado!')
		})
	</script>
</body>
</html>
